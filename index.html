<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="App para pesquisa de itens em arquivos Excel">
    <meta name="theme-color" content="#667eea">
    <title>ID Search - Pesquisa de Materiais</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css?v=4">

    <!-- SheetJS for Excel parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <span class="logo-icon">üìä</span>
                    <h1>ID Search</h1>
                </div>
                <p class="tagline">Pesquisa r√°pida em Excel</p>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Search Section (dados fixos carregados automaticamente) -->
            <section class="search-section" id="searchSection">
                <!-- Search Bar -->
                <div class="search-bar">
                    <div class="search-input-wrapper">
                        <span class="search-icon">üîç</span>
                        <input type="text" id="searchInput" placeholder="Digite para pesquisar..." autocomplete="off">
                        <button class="clear-btn" id="clearSearchBtn" title="Limpar">‚úï</button>
                    </div>

                    <!-- Column Filter -->
                    <div class="filter-wrapper">
                        <label for="columnFilter">Filtrar por coluna:</label>
                        <select id="columnFilter">
                            <option value="all">Todas as colunas</option>
                        </select>
                    </div>

                    <!-- Bot√£o Requisi√ß√£o -->
                    <button class="btn btn-primary" id="requisicaoBtn">
                        <span>üìã Requisi√ß√£o</span>
                    </button>

                    <!-- Bot√£o Lista de Pe√ßas -->
                    <button class="btn btn-secondary" id="listaPecasBtn">
                        <span>üì¶ Lista de Pe√ßas</span>
                    </button>
                </div>

                <!-- Stats Bar -->
                <div class="stats-bar">
                    <span id="resultCount">0 resultados</span>
                    <span id="totalCount">Total: 0 itens</span>
                </div>

                <!-- Results Table -->
                <div class="table-container">
                    <table id="resultsTable">
                        <thead id="tableHead"></thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                    <div class="no-results hidden" id="noResults">
                        <span class="no-results-icon">üîç</span>
                        <p>Nenhum resultado encontrado</p>
                    </div>
                </div>


            </section>

            <!-- Requisi√ß√£o Section -->
            <section class="requisicao-section hidden" id="requisicaoSection">
                <div class="requisicao-header">
                    <button class="btn-back" id="voltarBtn">‚Üê Voltar</button>
                    <h2>SR - Solicita√ß√£o de Requisi√ß√£o</h2>
                    <div class="header-buttons">
                        <button class="btn btn-outline" id="limparBtn">üóëÔ∏è Limpar</button>
                        <button class="btn btn-primary" id="imprimirBtn">üñ®Ô∏è Imprimir PDF</button>
                    </div>
                </div>

                <!-- Formul√°rio de Requisi√ß√£o -->
                <div class="requisicao-form" id="requisicaoForm">
                    <div class="form-header">
                        <img src="logo-cmaa.png" alt="CMAA" class="logo-cmaa-img">
                        <h1>SR - SOLICITA√á√ÉO DE REQUISI√á√ÉO</h1>
                    </div>

                    <div class="form-info">
                        <div class="info-group">
                            <label>SOLICITANTE:</label>
                            <input type="text" id="solicitante" class="form-input" placeholder="">
                        </div>
                        <div class="info-group">
                            <label>MATR√çCULA:</label>
                            <input type="text" id="matricula" class="form-input" placeholder="">
                        </div>
                        <div class="info-group">
                            <label>C.C / FROTA:</label>
                            <input type="text" id="ccFrota" class="form-input" placeholder="">
                        </div>
                        <div class="info-group">
                            <label>DATA:</label>
                            <input type="date" id="dataReq" class="form-input">
                        </div>
                    </div>

                    <!-- Tabela de Itens -->
                    <table class="requisicao-table">
                        <thead>
                            <tr>
                                <th class="col-id">ID (6 D√çG)</th>
                                <th class="col-desc">DESCRI√á√ÉO</th>
                                <th class="col-ref">REFER√äNCIA</th>
                                <th class="col-qty">QTD</th>
                                <th class="col-os">O.S</th>
                            </tr>
                        </thead>
                        <tbody id="requisicaoBody">
                            <!-- Linhas ser√£o adicionadas dinamicamente -->
                        </tbody>
                    </table>

                    <div class="btn-add-row-container">
                        <button class="btn btn-outline" id="addRowBtn">+ Adicionar Linha</button>
                    </div>

                    <div class="form-footer">
                        <div class="info-group footer-group">
                            <label>GESTOR:</label>
                            <input type="text" id="gestor" class="form-input" placeholder="">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Lista de Pe√ßas Section -->
            <section class="lista-pecas-section hidden" id="listaPecasSection">
                <div class="requisicao-header">
                    <button class="btn-back" id="voltarListaBtn">‚Üê Voltar</button>
                    <h2>üì¶ Lista de Pe√ßas para Pedido</h2>
                    <div class="header-buttons">
                        <button class="btn btn-outline" id="limparListaBtn">üóëÔ∏è Limpar</button>
                        <button class="btn btn-primary" id="imprimirListaBtn">üñ®Ô∏è Imprimir PDF</button>
                    </div>
                </div>

                <!-- Formul√°rio de Lista de Pe√ßas -->
                <div class="requisicao-form" id="listaPecasForm">
                    <div class="form-header lista-pecas-header">
                        <img src="logo-cmaa.png" alt="CMAA" class="logo-cmaa-img">
                        <h1>LISTA DE PE√áAS PARA PEDIDO</h1>
                    </div>

                    <div class="form-info lista-info">
                        <div class="info-group">
                            <label>DATA:</label>
                            <input type="date" id="dataLista" class="form-input">
                        </div>
                        <div class="info-group info-group-wide">
                            <label>OBSERVA√á√ïES:</label>
                            <input type="text" id="obsLista" class="form-input" placeholder="Informa√ß√µes adicionais...">
                        </div>
                    </div>

                    <!-- Tabela de Itens -->
                    <table class="requisicao-table lista-pecas-table">
                        <thead>
                            <tr>
                                <th class="col-id">ID (6 D√çG)</th>
                                <th class="col-desc">DESCRI√á√ÉO</th>
                                <th class="col-qty">QTD</th>
                                <th class="col-ref">REFER√äNCIA</th>
                            </tr>
                        </thead>
                        <tbody id="listaPecasBody">
                            <!-- Linhas ser√£o adicionadas dinamicamente -->
                        </tbody>
                    </table>

                    <div class="btn-add-row-container">
                        <button class="btn btn-outline" id="addListaRowBtn">+ Adicionar Linha</button>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>ID Search v1.0</p>
        </footer>
    </div>

    <!-- Toast Notification -->
    <div class="toast hidden" id="toast">
        <span class="toast-message"></span>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay hidden" id="loadingOverlay">
        <div class="spinner"></div>
        <p>Carregando...</p>
    </div>

    <!-- App Logic -->
    <script src="ewm-data.js"></script>
    <script src="app.js"></script>
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('ServiceWorker registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
    </script>
</body>

</html>